<project name="FCUBS_7-2_GW" default="all" basedir=".">

	<!-- set global properties for this build -->
	<property environment="env"/>  
	<property name="source" value="."/>
	<property name="ibm_was_home" value="${env.APP_SERVER_HOME}"/>
	<property name="ibm_was_ext" value="${ibm_was_home}/lib/ext"/>
	<property name="user_home" value="${env.USER_HOME}"/>
	<property name="src_http" value="../../src"/>
	<property name="src_common" value="../../src/common"/>
	<property name="config" value="../../config"/>
	<property name="notify_mdb_lib" value="../../lib"/>
	<property name="src_gw_notify_mdb" value="${src_http}/com/iflex/fcubs/gw/notify/mdb"/>
	<!-- KERNEL73 starts /-->
	<!-- Controller functionality moved to Bean starts
	<property name="src_contr_mdb" value="${src_common}/com/iflex/fcubs/gwcontrollers/notify/mdb"/>
	Controller functionality moved to Bean ends -->
	<!-- KERNEL73 ends /-->
	<property name="src_srvc_db" value="${src_common}/com/iflex/fcubs/gwservices/db"/>
	<property name="src_srvc_db_notify" value="${src_common}/com/iflex/fcubs/gwservices/db/notify"/>
	<property name="src_srvc_jms" value="${src_common}/com/iflex/fcubs/gwservices/jms"/>
	<property name="src_util" value="${src_common}/com/iflex/fcubs/gwutil"/>
	<property name="src_util_jms" value="${src_common}/com/iflex/fcubs/gwutil/jms"/>
	<property name="src_util_log" value="${src_common}/com/iflex/fcubs/gwutil/logging"/>
	<property name="build" value="../../build"/>
	<property name="dist" value="../../dist"/>

	<path id="compile.classpath">
		<pathelement location="${ibm_was_home}/lib/j2ee.jar"/>
		<pathelement location="${notify_mdb_lib}/ojdbc14.jar"/>
	</path>

  <target name="all" depends="clean_build, make_dir, compile_common, compile_notify_mdb, do_jar, do_ear, clean"/>

	<target name="clean_build">
 		<delete dir="${build}"/>
	</target>

	<!-- Create the build directory structure used by compile
	and copy the deployment descriptors into it-->
	<target name="make_dir">
		<!-- Create the time stamp -->
		<tstamp/>
		<mkdir dir="${build}"/>
		<mkdir dir="${build}/META-INF"/>
		<mkdir dir="${dist}"/>
		<mkdir dir="${dist}/META-INF"/>

		<!-- Create the time stamp -->
		<copy todir="${dist}/META-INF">
			<fileset dir="${config}">
				<include name="ejb-jar.xml"/>
			</fileset>
		</copy>

		<!-- Create the time stamp -->
		<copy todir="${build}/META-INF">
			<fileset dir="${config}">
				<include name="application.xml"/>
			</fileset>
		</copy>
	</target>

	<target name="compile_common" depends="make_dir">
		<javac 
			srcdir="${src_util}"
			destdir="${dist}"
            debug="on">
			<classpath>
				<path refid="compile.classpath"/>
			</classpath>
		</javac>
		<javac 
			srcdir="${src_util_jms}"
			destdir="${dist}"
            debug="on">
			<classpath>
				<path refid="compile.classpath"/>
			</classpath>
		</javac>
		<javac 
			srcdir="${src_util_log}"
			destdir="${dist}"
            debug="on">
			<classpath>
				<path refid="compile.classpath"/>
			</classpath>
		</javac>
		<javac 
			srcdir="${src_srvc_db}"
			destdir="${dist}"
            debug="on">
			<classpath>
				<path refid="compile.classpath"/>
			</classpath>
		</javac>
		<javac 
			srcdir="${src_srvc_db_notify}"
			destdir="${dist}"
            debug="on">
			<classpath>
				<path refid="compile.classpath"/>
			</classpath>
		</javac>
		<javac 
			srcdir="${src_srvc_jms}"
			destdir="${dist}"
            debug="on">
			<classpath>
				<path refid="compile.classpath"/>
			</classpath>
		</javac>
		
	</target>

	<!-- Compile the java code -->
	<target name="compile_notify_mdb" depends="compile_common"> 
		<javac srcdir="${src_gw_notify_mdb}" destdir="${dist}" debug="on">
			<classpath>
				<path refid="compile.classpath"/>
			</classpath>
		</javac>
	</target>

	<!-- Make a standard ejb jar file, including XML deployment descriptors -->
	<target name="do_jar" depends="compile_notify_mdb">
		<jar destfile="${build}/GW_NOTIFY_MDB_Bean.jar" 
			basedir="${dist}">
		</jar>
	</target>

	<!-- Make a standard ejb jar file, including XML deployment descriptors -->
	<target name="do_ear" depends="do_jar">
		<ear destfile="${source}/GW_NOTIFY_MDB_Bean.ear" appxml="${build}/META-INF/application.xml">
			<fileset dir="${build}"  includes="GW_NOTIFY_MDB_Bean.jar"/>
		</ear>
		<move file="${source}/GW_NOTIFY_MDB_Bean.ear" todir="${build}"/>
	</target>

	<target name="clean">
 		<delete dir="${dist}"/>
		<delete dir="${build}/META-INF"/>
	</target>
</project>
